<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=author content="Terry Tang"><meta name=description content="Introduce
The best way to understand the structure of the sources code is to write some modules by yourself. Let&rsquo;s us to write an Analyzer in the Bro by Binpac. We choose 
RIP v2 to write the first protocol."><link rel=alternate hreflang=en-us href=http://www.guozet.me/post/Write-your-first-Analyzer-en/><meta name=theme-color content="#3f51b5"><script src=/js/mathjax-config.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css crossorigin=anonymous title=hl-dark disabled><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href=/css/academic.css><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png><link rel=canonical href=http://www.guozet.me/post/Write-your-first-Analyzer-en/><meta property="twitter:card" content="summary"><meta property="og:site_name" content="Terry Tang"><meta property="og:url" content="http://www.guozet.me/post/Write-your-first-Analyzer-en/"><meta property="og:title" content="Complete your first analyzer - RIP in bro | Terry Tang"><meta property="og:description" content="Introduce
The best way to understand the structure of the sources code is to write some modules by yourself. Let&rsquo;s us to write an Analyzer in the Bro by Binpac. We choose 
RIP v2 to write the first protocol."><meta property="og:image" content="http://www.guozet.me/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png"><meta property="twitter:image" content="http://www.guozet.me/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2018-05-24T20:30:32+00:00"><meta property="article:modified_time" content="2018-05-24T20:30:32+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.guozet.me/post/Write-your-first-Analyzer-en/"},"headline":"Complete your first analyzer - RIP in bro","datePublished":"2018-05-24T20:30:32Z","dateModified":"2018-05-24T20:30:32Z","author":{"@type":"Person","name":"Terry Tang"},"publisher":{"@type":"Organization","name":"Terry Tang","logo":{"@type":"ImageObject","url":"http://www.guozet.me/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"}},"description":"\u003ch2 id=\"introduce\"\u003eIntroduce\u003c/h2\u003e\n\u003cp\u003eThe best way to understand the structure of the sources code is to write some modules by yourself. Let\u0026rsquo;s us to write an Analyzer in the Bro by Binpac. We choose \n\u003ca href=\"https://tools.ietf.org/html/rfc2453\" target=\"_blank\" rel=\"noopener\"\u003eRIP v2\u003c/a\u003e to write the first protocol.\u003c/p\u003e"}</script><title>Complete your first analyzer - RIP in bro | Terry Tang</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Terry Tang</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Terry Tang</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class="nav-link active" href=/post><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/#featured><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/courses/><span>Courses</span></a></li><li class=nav-item><a class=nav-link href=/leetcode><span>Leetcode</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class="nav-link js-theme-selector" data-toggle=dropdown aria-haspopup=true><i class="fas fa-palette" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav><article class=article><div class="article-container pt-3"><h1>Complete your first analyzer - RIP in bro</h1><div class=article-metadata><span class=article-date>May 24, 2018</span>
<span class=middot-divider></span><span class=article-reading-time>10 min read</span>
<span class=middot-divider></span><a href=/post/Write-your-first-Analyzer-en/#disqus_thread></a><span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/Project/>Project</a></span></div></div><div class=article-container><div class=article-style><h2 id=introduce>Introduce</h2><p>The best way to understand the structure of the sources code is to write some modules by yourself. Let&rsquo;s us to write an Analyzer in the Bro by Binpac. We choose
<a href=https://tools.ietf.org/html/rfc2453 target=_blank rel=noopener>RIP v2</a> to write the first protocol.</p><h2 id=how-to-use-binpac-quick-start-to-create-the-relative-file-to-develop-an-analyzer>How to Use Binpac quick start to create the relative file to develop an analyzer?</h2><h4 id=download-binpac-quick-start>Download Binpac Quick Start</h4><p><code>git clone https://github.com/grigorescu/binpac_quickstart.git</code>
When you finish download, you can enter the <code>binpac_quickstart</code> directory, then you will find there are some files in this directory as blow.</p><pre><code class=language-bash>Guoze@node-0:~/00_Workbench$ cd binpac_quickstart/
Guoze@node-0:~/00_Workbench/binpac_quickstart$ ls -al
total 32
drwxr-xr-x  4 Guoze senfv-PG0 4096 May 22 19:30 .
drwxr-xr-x 11 Guoze senfv-PG0 4096 May 23 12:15 ..
drwxr-xr-x  8 Guoze senfv-PG0 4096 May 22 19:30 .git
-rw-r--r--  1 Guoze senfv-PG0   21 May 22 19:30 __init__.py
-rw-r--r--  1 Guoze senfv-PG0  128 May 22 19:30 README.md
-rwxr-xr-x  1 Guoze senfv-PG0 7151 May 22 19:30 start.py
drwxr-xr-x  2 Guoze senfv-PG0 4096 May 22 19:30 templates
</code></pre><h4 id=user-startpyto-create-the-directory-structure-in-bro>User <code>start.py</code>to create the directory structure in Bro</h4><p>start.py is the script which who can use to build a directory structure to develp the RIP analyzer. We can use this script as following.</p><pre><code class=language-bash>Guoze@node-0:~/00_Workbench/binpac_quickstart$ ./start.py 
Usage:
    start.py NAME DESCRIPTION PATH_TO_BRO_SRC (--tcp|--udp) [--buffered] [--plugin]
</code></pre><blockquote><p>Example: <code>./start.py RIP "Routing Internet Protocl" ../bro --udp</code>
Procotol name：RIP；
Procoto description：Routing Internet Protocl
The absolute path of the Bro source code：../bro
The type of Network Portocol which the RIP use：&ndash;udp</p></blockquote><p>Use this script to built RIP work directory in the Bro source code file. If you don&rsquo;t know RIP protocol before, please read the
<a href=https://tools.ietf.org/html/rfc2453 target=_blank rel=noopener>RIP protocol documents</a>.</p><p>In the terminal, we just need to input the command as follows to create our work directory.
<code>./start.py RIP "Routing Internet Protocl" ../bro --udp</code></p><p>After complete, It will create some files in the <code>bro/scripts/base/protocols/rip/</code> directory and <code>bro/src/analyzer/protocol/rip/</code> directory</p><ol><li><code>bro/scripts/base/protocols/rip/</code></li></ol><pre><code class=language-bash>Guoze@node-0:~/00_Workbench/bro/scripts/base/protocols/rip$ ls -l
total 12
-rw-r--r-- 1 Guoze senfv-PG0  245 May 23 12:49 dpd.sig
-rw-r--r-- 1 Guoze senfv-PG0   66 May 23 12:49 __load__.bro
-rw-r--r-- 1 Guoze senfv-PG0 1327 May 23 12:49 main.bro
</code></pre><blockquote><p>__load__.bro: This allows all the contents of the directory to be loaded via @load base/protocols/sip.
dpd.sig: This file contains a signature that can be used to attach the analyzer to connections if their content matches.
main.bro: Contains the base script-layer functionality for processing events emitted from the analyzer.</p></blockquote><ol start=2><li><code>src/analyzer/protocol/sip/</code></li></ol><pre><code class=language-bash>Guoze@node-0:~/00_Workbench/bro/src/analyzer/protocol/rip$ ls -l
total 32
-rw-r--r-- 1 Guoze senfv-PG0  301 May 23 12:50 CMakeLists.txt
-rw-r--r-- 1 Guoze senfv-PG0  472 May 23 12:50 events.bif
-rw-r--r-- 1 Guoze senfv-PG0  480 May 23 12:50 Plugin.cc
-rw-r--r-- 1 Guoze senfv-PG0  738 May 23 15:27 rip-analyzer.pac
-rw-r--r-- 1 Guoze senfv-PG0  721 May 23 12:50 RIP.cc
-rw-r--r-- 1 Guoze senfv-PG0  715 May 23 12:50 RIP.h
-rw-r--r-- 1 Guoze senfv-PG0 1005 May 23 12:50 rip.pac
-rw-r--r-- 1 Guoze senfv-PG0  939 May 23 15:03 rip-protocol.pac
</code></pre><blockquote><p>CMakeLists.txt: Informs the CMake build system how to compile the analyzer.
Plugin.cc: Analyzers in Bro are a type of plugin. This file does what’s necessary to register the new analyzer plugin with Bro.
RIP.h: Defines the API for the new analyzer which derives from one of Bro’s already-existing analyzer classes.
RIP.cc: Implementation of the analyzer. It’s mostly just responsible for handing off data to the protocol parser that’s been generated by BinPAC.
events.bif: Defines events that the analyzer will generate.
rip.pac: The main entry point for the BinPAC definition of the protocol that you want to parse.
rip-protocol.pac: Where the message format is defined.<br>rip-analyzer.pac: Defines a connection, flow, and other processing functions for the analyzer.</p></blockquote><p>If you just want to use Binpac to compile your c++ file, you just need to write these files:</p><ul><li>events.bif</li><li>rip.pac</li><li>rip-protocol.pac</li><li>rip-analyzer.pac</li></ul><h2 id=implementation>Implementation</h2><h3 id=implement-the-rip-protocolpac-file>Implement the rip-protocol.pac file</h3><p>This file just defines each part in the RIP protocol. In the code, you will find the Binpac language use keywords <code>type</code> to express a data structure in the RIP protocol. The <code>RIP_PDU</code>funtion which is the lastest type in this file defines the data structure which user want to transfer when the RIP event happens.</p><p>The RIP packet format is:</p><pre><code>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |  command (1)  |  version (1)  |       must be zero (2)        |
  +---------------+---------------+-------------------------------+
  |                                                               |
  ~                         RIP Entry (20)                        ~
  |                                                               |
  +---------------+---------------+---------------+---------------+
</code></pre><p>There may be between 1 and 25 (inclusive) RIP entries. A RIP-1 entry
has the following format:</p><pre><code>   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  | address family identifier (2) |      must be zero (2)         |
  +-------------------------------+-------------------------------+
  |                        IPv4 address (4)                       |
  +---------------------------------------------------------------+
  |                        must be zero (4)                       |
  +---------------------------------------------------------------+
  |                        must be zero (4)                       |
  +---------------------------------------------------------------+
  |                           metric (4)                          |
  +---------------------------------------------------------------+
</code></pre><p>Use this file to design the protocol structures of RIP in our case. Just take the structures from the protocol and write the code in this file to parse it.</p><pre><code>   Protocol Extensions
   RIP-2 is:
   0                   1                   2                   3 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Address Family Identifier (2) |        Route Tag (2)          |
   +-------------------------------+-------------------------------+
   |                         IP Address (4)                        |
   +---------------------------------------------------------------+
   |                         Subnet Mask (4)                       |
   +---------------------------------------------------------------+
   |                         Next Hop (4)                          |
   +---------------------------------------------------------------+
   |                         Metric (4)                            |
   +---------------------------------------------------------------+
</code></pre><p>The Address Family Identifier, IP Address, and Metric all have the meanings defined in
<a href=https://tools.ietf.org/html/rfc2453#section-3.4 target=_blank rel=noopener>section 3.4</a>. The Version field will specify</p><pre><code class=language-cpp>1   # Generated by binpac_quickstart                                                                                                                                                      
  1                                                                                                                                                                                       
  2 # ## TODO: Add your protocol structures in here.                                                                                                                                      
  3 # ## some examples:                                                                                                                                                                   
  4                                                                                                                                                                                       
  5 # Types are your basic building blocks.                                                                                                                                               
  6 # There are some builtins, or you can define your own.                                                                                                                                
  7 # Here's a definition for a regular expression:                                                                                                                                       
  8 # type RIP_WHITESPACE = RE/[ \t]*/;                                                                                                                                                   
  9                                                                                                                                                                                       
 10 # A record is a collection of types.                                                                                                                                                  
 11 # Here's one with the built-in types                                                                                                                                                  
 12                                                                                                                                                                                       
 13 enum Rip_Command {                                                                                                                                                                    
 14     RIP_REQUEST     = 1,                                                                                                                                                              
 15     RIP_RESPONSE    = 2,                                                                                                                                                              
 16 }                                                                                                                                                                                     
 17                                                                                                                                                                                       
 18 enum Rip_Version {                                                                                                                                                                    
 19     RIP_V1   = 1,                                                                                                                                                                     
 20     RIP_V2   = 2,                                                                                                                                                                     
 21 }                                                                                                                                                                                     
 22                                                                                                                                                                                       
 23 type Rip_Message = record {    //Base Message                                                                                                                                                           
 24     command : uint8;                                                                                                                                                                  
 25     version : uint8;                                                                                                                                                                  
 26     pad     : padding[2];         //must be zero                                                                                                                                                    
 27     entry   : Rip_Entry[] &amp;until($input.length()) == 0;                                                                                                                                
 28 };                                                                                                                                                                                    
 29                                                                                                                                                                                       
 30 type Rip_Entry = record {
 31     af      : uint16;                                                                                                                                                                 
 32     rt      : uint16;                                                                                                                                                                 
 33     ip      : uint32;                                                                                                                                                                 
 34     mask    : uint32;                                                                                                                                                                 
 35     gateway : uint32;                                                                                                                                                                 
 36     metric  : uint32;                                                                                                                                                                 
 37 };                                                                                                                                                                                    
 38                                                                                                                                                                                       
 39 type RIP_PDU(is_orig: bool) = record {                                                                                                                                                
 40     command : uint8;                                                                                                                                                                  
 41     version : uint8;                                                                                                                                                                  
 42     pad     : padding[2];                                                                                                                                                             
 43 } &amp;byteorder=bigendian;                                                                                                                                                               
</code></pre><p>RIP_PDU structure: pass to the user land, just focus which you want to pass.</p><h3 id=implement-the-rip_analyzerpac-file>Implement the rip_analyzer.pac file</h3><p>This file mainly finishes the processing and analyzing of the data which was passed by the <code>RIP_PDU</code> function to this file. If there is a RIP event happens, then it enters this processing flow.</p><p>The <code>BifEvent::generate_rip_request</code> function illustrates how to generate an request event. We use this event to pass the data structure which is important in the next process (the data structure created in rip_protocol.pac). The main thing we need to define is what we want to pass. Such as: <code>msg.command</code>, <code>msg.version</code></p><p>%code{ &mldr; %} : Copy C++ code to the generated source file</p><pre><code class=language-cpp>1   # Generated by binpac_quickstart                                                                                                                                                      
  1             
  2 refine flow RIP_Flow += {                                                                                                                                                             
  3     function proc_rip_message(msg: RIP_PDU): bool                                                                                                                                     
  4         %{  
  5         // Check for RIP commands                                                                                                                                                     
  6         if ( ${msg.command} == RIP_REQUEST) {                                                                                                                                         
  7             BifEvent::generate_rip_request(connection()-&gt;bro_analyzer(), connection()-&gt;bro_analyzer()-&gt;Conn(),
  8             ${msg.command},                      //Pass more thing                                                                                                                                       
  9             ${msg.version});                                                                                                                                                          
 10             return true;                                                                                                                                                              
 11         }   
 12         if ( ${msg.command} == RIP_RESPONSE) {                                                                                                                                        
 13             BifEvent::generate_rip_response(connection()-&gt;bro_analyzer(), connection()-&gt;bro_analyzer()-&gt;Conn(),                                                                       
 14             ${msg.command},                                                                                                                                                           
 15             ${msg.version});                                                                                                                                                          
 16             return true;                                                                                                                                                              
 17         }   
 18         %}  
 19 };          
 20             
 21 refine typeattr RIP_PDU += &amp;let {                                                                                                                                                     
 22     proc: bool = $context.flow.proc_rip_message(this);                                                                                                                                
 23 };          
~
</code></pre><p><code>function proc_rip_message(msg: RIP_PDU): bool</code> just like to say please use that RIP_PDU data structure that was defined in the earlier file.</p><h3 id=implement-the-eventsbif-file>Implement the events.bif file</h3><pre><code class=language-cpp>1   # Generated by binpac_quickstart                                                                                                                                                      
  1  
  2 # In this file, you'll define the events that your analyzer will                                                                                                                      
  3 # generate. A sample event is included.                                                                                                                                               
  4  
  5 # ## TODO: Edit the sample event, and add more events.                                                                                                                                
  6  
  7 ## Generated for RIP connections                                                                                                                                                      
  8 ##                                                                                                                                                                                    
  9 ## See `Google &lt;http://lmgtfy.com/?q=RIP&gt;`__ for more information about RIP                                                                                                           
 10 ##                                                                                                                                                                                    
 11 ## c: The connection                                                                                                                                                                  
 12 ##                                                                                                                                                                                    
 13 event rip_request%(c: connection, command: count, version: count%);                                                                                                                   
 14 event rip_response%(c: connection, command: count, version: count%);
</code></pre><p>RIP just have two types of command:</p><ul><li>rip_request</li><li>rip_response</li></ul><h2 id=test>Test</h2><h3 id=configure-bros-working-environment>Configure Bro&rsquo;s Working Environment</h3><p>Firstly, we need to configure the bro&rsquo;s path to execute it.
The executable path of the Bro is <code>bro/build/src/bro</code>.</p><pre><code class=language-bash>Guoze@node-0:~/00_Workbench/bro$ ./build/src/bro -h
bro version 2.5-598
usage: ./build/src/bro [options] [file ...]
    &lt;file&gt;                         | policy file, or read stdin
    -a|--parse-only                | exit immediately after parsing scripts
    -b|--bare-mode                 | don't load scripts from the base/ directory
    -d|--debug-policy              | activate policy file debugging
    -e|--exec &lt;bro code&gt;           | augment loaded policies by given code
    -f|--filter &lt;filter&gt;           | tcpdump filter
</code></pre><p>Bro has provided an executable script for you. As a result, you can easily configure environment variables. We just need to execute the configuration script. Use the shell script for configuring environment variables is as follows:</p><pre><code class=language-bash>Guoze@node-0:~/00_Workbench/bro/build$ cat bro-path-dev.sh 
export BROPATH=`/users/Guoze/00_Workbench/bro/build/bro-path-dev`
export BRO_PLUGIN_PATH=&quot;/users/Guoze/00_Workbench/bro/build/src&quot;:
export PATH=&quot;/users/Guoze/00_Workbench/bro/build/src&quot;:$PATH
</code></pre><pre><code class=language-bash>Guoze@node-0:~/00_Workbench/bro$ source ./build/bro-path-dev.sh
</code></pre><p>If you want to check the execution status of the script and determine whether it has completed the configuration, you can enter: <code>bro -h</code>in the terminal. If the execution result is as same as the result of <code>./build/src/bro -h</code>, then it means that the configuration has been configured successfully.</p><pre><code class=language-bash>Guoze@node-0:~/00_Workbench/bro$ bro -h
bro version 2.5-598
usage: bro [options] [file ...]
    &lt;file&gt;                         | policy file, or read stdin
    -a|--parse-only                | exit immediately after parsing scripts
    -b|--bare-mode                 | don't load scripts from the base/ directory
    -d|--debug-policy              | activate policy file debugging
    -e|--exec &lt;bro code&gt;           | augment loaded policies by given code
    -f|--filter &lt;filter&gt;           | tcpdump filter
    -g|--dump-config               | dump current config into .state dir
    -h|--help|-?                   | command line help
</code></pre><h3 id=test-rip-parser>Test RIP parser</h3><h4 id=download-rip-network-data>Download RIP Network data</h4><p>We can directly download a RIPv2 packet which can be used for testing on Internet.
<code>$ wget http://packetlife.net/captures/RIPv2.cap</code></p><p>After download, use the command &lsquo;tcpdump&rsquo; to determine whether the data packet contains RIP data.</p><pre><code class=language-bash>Guoze@node-0:~/00_Workbench$ tcpdump -nr RIPv2.cap
reading from file RIPv2.cap, link-type EN10MB (Ethernet)
23:06:26.942558 IP 10.0.0.1.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:06:30.158769 IP 10.0.0.2.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:06:52.663855 IP 10.0.0.1.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:06:58.416478 IP 10.0.0.2.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:07:19.709681 IP 10.0.0.1.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:07:24.974047 IP 10.0.0.2.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:07:45.389720 IP 10.0.0.1.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:07:53.891896 IP 10.0.0.2.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:08:14.625084 IP 10.0.0.1.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:08:21.933550 IP 10.0.0.2.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:08:41.410659 IP 10.0.0.1.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
23:08:47.731064 IP 10.0.0.2.520 &gt; 224.0.0.9.520: RIPv2, Response, length: 84
</code></pre><h4 id=add-some-print-information>Add some print information</h4><pre><code class=language-cpp> 12 refine flow RIP_Flow += {          
 11     function proc_rip_message(msg: RIP_PDU): bool
 10         %{                         
  9         // Check for RIP commands  
  8         if ( ${msg.command} == RIP_REQUEST) { 
  7             printf(&quot;In rip_request\n&quot;);
  6             BifEvent::generate_rip_request(connection()-&gt;bro_analyzer(), connection()-&gt;bro_analyzer()-&gt;Conn(),
  5             ${msg.command},        
  4             ${msg.version});       
  3             return true;           
  2         }                          
  1         if ( ${msg.command} == RIP_RESPONSE) {
15              printf(&quot;In rip_response\n&quot;);                                                                                                                                              
  1             BifEvent::generate_rip_response(connection()-&gt;bro_analyzer(), connection()-&gt;bro_analyzer()-&gt;Conn(),
  2             ${msg.command},        
  3             ${msg.version});       
  4             return true;           
  5         }                          
  6         %}
</code></pre><p>After change, <code>make</code> the code again.</p><pre><code class=language-bash>Guoze@node-0:~/00_Workbench/bro$ sudo make
make -C build all
make[1]: Entering directory '/users/Guoze/00_Workbench/bro/build'
make[2]: Entering directory '/users/Guoze/00_Workbench/bro/build'
make[3]: Entering directory '/users/Guoze/00_Workbench/bro/build'
make[3]: Leaving directory '/users/Guoze/00_Workbench/bro/build'
........
........
[100%] Built target rst
make[2]: Leaving directory '/users/Guoze/00_Workbench/bro/build'
make[1]: Leaving directory '/users/Guoze/00_Workbench/bro/build'
</code></pre><h4 id=use-network-capture-data-for-testing>Use Network Capture Data for Testing</h4><pre><code class=language-bash>Guoze@node-0:~/00_Workbench$ bro -r RIPv2.cap 
In rip_response
In rip_response
In rip_response
In rip_response
In rip_response
In rip_response
In rip_response
In rip_response
In rip_response
In rip_response
In rip_response
In rip_response
</code></pre></div><div class=article-tags><a class="badge badge-light" href=/tag/Network/>Network</a></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=http://www.guozet.me/post/Write-your-first-Analyzer-en/&text=Complete%20your%20first%20analyzer%20-%20RIP%20in%20bro" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=http://www.guozet.me/post/Write-your-first-Analyzer-en/&t=Complete%20your%20first%20analyzer%20-%20RIP%20in%20bro" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Complete%20your%20first%20analyzer%20-%20RIP%20in%20bro&body=http://www.guozet.me/post/Write-your-first-Analyzer-en/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=http://www.guozet.me/post/Write-your-first-Analyzer-en/&title=Complete%20your%20first%20analyzer%20-%20RIP%20in%20bro" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="https://web.whatsapp.com/send?text=Complete%20your%20first%20analyzer%20-%20RIP%20in%20bro%20http://www.guozet.me/post/Write-your-first-Analyzer-en/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=http://www.guozet.me/post/Write-your-first-Analyzer-en/&title=Complete%20your%20first%20analyzer%20-%20RIP%20in%20bro" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><img class="avatar mr-3 avatar-circle" src=/author/Terry-Tang/avatar_hu0d5a7b86078ca7c7d7d2e2c9e8f7e04b_578713_270x270_fill_q90_lanczos_center.jpg alt="Terry Tang"><div class=media-body><h5 class=card-title><a href=http://www.guozet.me/>Terry Tang</a></h5><h6 class=card-subtitle>Software Development Engineer</h6><p class=card-text>My research interests include distributed robotics, mobile computing and programmable matter.</p><ul class=network-icon aria-hidden=true><li><a href=/#contact><i class="fas fa-envelope"></i></a></li><li><a href=https://github.com/guozetang target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://www.facebook.com/guozetang target=_blank rel=noopener><i class="fab fa-facebook"></i></a></li><li><a href=https://www.linkedin.com/in/guoze/ target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li><li><a href=https://instagram.com/guozetang target=_blank rel=noopener><i class="fab fa-instagram"></i></a></li><li><a href=https://leetcode.com/guozetang/ target=_blank rel=noopener><i class="fas fa-laptop-code"></i></a></li><li><a href=/files/cv.pdf><i class="ai ai-cv"></i></a></li></ul></div></div><section id=comments><div id=disqus_thread></div><script>let disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='https://'+"guozet-me"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section><div class="article-widget content-widget-hr"><h3>Related</h3><ul><li><a href=/post/Install-bro-Binpac/>Ubuntu 16.04安装bro和Binpac</a></li><li><a href=/post/Write-first-Analyzer-rip/>在Bro中完成第一个协议分析器—RIP协议</a></li></ul></div></div></article><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js></script><script>const code_highlighting=true;</script><script>const isSiteThemeDark=false;</script><script>const search_config={"indexURI":"/index.json","minLength":1,"threshold":0.3};const i18n={"no_results":"No results found","placeholder":"Search...","results":"results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks"};</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script id=dsq-count-scr src=https://guozet-me.disqus.com/count.js async></script><script src=/js/academic.min.37431be2d92d7fb0160054761ab79602.js></script><div class=container><footer class=site-footer><p class=powered-by>guozet.me © 2020</p><p class=powered-by>Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>